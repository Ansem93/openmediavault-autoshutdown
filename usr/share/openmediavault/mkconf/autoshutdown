#!/bin/sh
#
# @license   http://www.gnu.org/licenses/gpl.html GPL Version 3
# @author    Marcel Beck <marcel.beck@mbeck.org>
# @copyright Copyright (c) 2012 Marcel Beck
#
# This file is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# any later version.
#
# This file is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this file. If not, see <http://www.gnu.org/licenses/>.

set -e

. /etc/default/openmediavault
. /usr/share/openmediavault/scripts/helper-functions

AUTOSHUTDOWN_CONFIG="/etc/autoshutdown.conf"

cat <<EOF > ${AUTOSHUTDOWN_CONFIG}
# This configuration file is auto-generated.
# WARNING: Do not edit this file, your changes will be lost.

CYCLES=$(omv_config_get "//services/autoshutdown/cycles")
SLEEP=$(omv_config_get "//services/autoshutdown/sleep")
RANGE="$(omv_config_get "//services/autoshutdown/range")"

CHECKCLOCKACTIVE="$( if [ `omv_config_get "//services/autoshutdown/checkclockactive"` = "1" ]; then echo "true"; else echo "false"; fi)"
UPHOURS="$(omv_config_get "//services/autoshutdown/uphours-begin")..$(omv_config_get "//services/autoshutdown/uphours-end")"

NSOCKETNUMBERS="$(omv_config_get "//services/autoshutdown/nsocketnumbers")"
ULDLCHECK="$( if [ `omv_config_get "//services/autoshutdown/uldlcheck"` = "1" ]; then echo "true"; else echo "false"; fi)"
ULDLRATE=$(omv_config_get "//services/autoshutdown/uldlrate")
LOADAVERAGECHECK="$( if [ `omv_config_get "//services/autoshutdown/loadaveragecheck"` = "1" ]; then echo "true"; else echo "false"; fi)"
LOADAVERAGE=$(omv_config_get "//services/autoshutdown/loadaverage")

SYSLOG="$( if [ `omv_config_get "//services/autoshutdown/syslog"` = "1" ]; then echo "true"; else echo "false"; fi)"
VERBOSE="$( if [ `omv_config_get "//services/autoshutdown/verbose"` = "1" ]; then echo "true"; else echo "false"; fi)"
FAKE="$( if [ `omv_config_get "//services/autoshutdown/fake"` = "1" ]; then echo "true"; else echo "false"; fi)"

$(omv_config_get "//services/autoshutdown/extraoptions")

EOF
